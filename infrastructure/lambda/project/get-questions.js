"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
const api_1 = require("../helpers/api");
const common_1 = require("../constants/common");
const organization_1 = require("../constants/organization");
const answer_1 = require("../constants/answer");
const ddbClient = new client_dynamodb_1.DynamoDBClient({});
const docClient = lib_dynamodb_1.DynamoDBDocumentClient.from(ddbClient);
const DB_TABLE_NAME = process.env.DB_TABLE_NAME;
if (!DB_TABLE_NAME)
    throw new Error('DB_TABLE_NAME env var is missing');
const handler = async (event) => {
    try {
        const projectId = event.pathParameters?.id;
        if (!projectId) {
            return (0, api_1.apiResponse)(400, { message: 'Missing projectId' });
        }
        const flatQuestions = await loadQuestions(projectId);
        const grouped = await groupQuestions(projectId, flatQuestions);
        return (0, api_1.apiResponse)(200, { sections: grouped });
    }
    catch (err) {
        console.error('getProjectQuestions error', err);
        return (0, api_1.apiResponse)(500, {
            message: 'Internal error',
            error: err instanceof Error ? err.message : 'Unknown',
        });
    }
};
exports.handler = handler;
// ---------- LOAD QUESTIONS FROM DYNAMODB ----------
async function loadQuestions(projectId) {
    let items = [];
    let LastKey;
    const prefix = `${projectId}#`;
    do {
        const res = await docClient.send(new lib_dynamodb_1.QueryCommand({
            TableName: DB_TABLE_NAME,
            KeyConditionExpression: '#pk = :pk AND begins_with(#sk, :prefix)',
            ExpressionAttributeNames: {
                '#pk': common_1.PK_NAME,
                '#sk': common_1.SK_NAME,
            },
            ExpressionAttributeValues: {
                ':pk': organization_1.QUESTION_PK,
                ':prefix': prefix,
            },
            ExclusiveStartKey: LastKey,
        }));
        if (res.Items)
            items.push(...res.Items);
        LastKey = res.LastEvaluatedKey;
    } while (LastKey);
    return items;
}
// ---------- GET SINGLE ANSWER FOR QUESTION ----------
// ANSWER PK = ANSWER_PK
// SK = `${projectId}#${questionId}#${answerId}`
// and there is at most one item per question â†’ use Limit: 1
async function getAnswer(projectId, questionId) {
    const prefix = `${projectId}#${questionId}#`;
    const res = await docClient.send(new lib_dynamodb_1.QueryCommand({
        TableName: DB_TABLE_NAME,
        KeyConditionExpression: '#pk = :pk AND begins_with(#sk, :prefix)',
        ExpressionAttributeNames: {
            '#pk': common_1.PK_NAME,
            '#sk': common_1.SK_NAME,
        },
        ExpressionAttributeValues: {
            ':pk': answer_1.ANSWER_PK,
            ':prefix': prefix,
        },
        Limit: 1,
    }));
    if (!res.Items || res.Items.length === 0) {
        return null;
    }
    return res.Items[0];
}
// ---------- GROUP INTO FE SHAPE ----------
async function groupQuestions(projectId, flat) {
    const sectionsMap = new Map();
    for (const item of flat) {
        const secId = item.sectionId;
        if (!sectionsMap.has(secId)) {
            sectionsMap.set(secId, {
                id: secId,
                title: item.sectionTitle,
                description: item.sectionDescription ?? null,
                questions: [],
            });
        }
        const qId = item.questionId;
        const answerItem = await getAnswer(projectId, qId);
        sectionsMap.get(secId).questions.push({
            id: qId,
            question: item.questionText,
            answer: answerItem?.text ?? null,
        });
    }
    return Array.from(sectionsMap.values());
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0LXF1ZXN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdldC1xdWVzdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsOERBQTBEO0FBQzFELHdEQUE2RTtBQUU3RSx3Q0FBNkM7QUFDN0MsZ0RBQXVEO0FBQ3ZELDREQUF3RDtBQUN4RCxnREFBZ0Q7QUFFaEQsTUFBTSxTQUFTLEdBQUcsSUFBSSxnQ0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3pDLE1BQU0sU0FBUyxHQUFHLHFDQUFzQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUV6RCxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQztBQUNoRCxJQUFJLENBQUMsYUFBYTtJQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztBQUVqRSxNQUFNLE9BQU8sR0FBRyxLQUFLLEVBQzFCLEtBQTZCLEVBQ0ssRUFBRTtJQUNwQyxJQUFJLENBQUM7UUFDSCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQztRQUMzQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDZixPQUFPLElBQUEsaUJBQVcsRUFBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO1FBQzVELENBQUM7UUFFRCxNQUFNLGFBQWEsR0FBRyxNQUFNLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNyRCxNQUFNLE9BQU8sR0FBRyxNQUFNLGNBQWMsQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFFL0QsT0FBTyxJQUFBLGlCQUFXLEVBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLDJCQUEyQixFQUFFLEdB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QUFTLEVBQUUsRUFBRTthQUNkLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBb0IsQ0FBQztRQUN0QyxNQUFNLFVBQVUsR0FBRyxNQUFNLFNBQVMsQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFbkQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO1lBQ3BDLEVBQUUsRUFBRSxHQUFHO1lBQ1AsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZO1lBQzNCLE1BQU0sRUFBRSxVQUFVLEVBQUUsSUFBSSxJQUFJLElBQUk7U0FDakMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUMxQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnRWMiwgQVBJR2F0ZXdheVByb3h5UmVzdWx0VjIgfSBmcm9tICdhd3MtbGFtYmRhJztcbmltcG9ydCB7IER5bmFtb0RCQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiJztcbmltcG9ydCB7IER5bmFtb0RCRG9jdW1lbnRDbGllbnQsIFF1ZXJ5Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2xpYi1keW5hbW9kYic7XG5cbmltcG9ydCB7IGFwaVJlc3BvbnNlIH0gZnJvbSAnLi4vaGVscGVycy9hcGknO1xuaW1wb3J0IHsgUEtfTkFNRSwgU0tfTkFNRSB9IGZyb20gJy4uL2NvbnN0YW50cy9jb21tb24nO1xuaW1wb3J0IHsgUVVFU1RJT05fUEsgfSBmcm9tICcuLi9jb25zdGFudHMvb3JnYW5pemF0aW9uJztcbmltcG9ydCB7IEFOU1dFUl9QSyB9IGZyb20gJy4uL2NvbnN0YW50cy9hbnN3ZXInO1xuXG5jb25zdCBkZGJDbGllbnQgPSBuZXcgRHluYW1vREJDbGllbnQoe30pO1xuY29uc3QgZG9jQ2xpZW50ID0gRHluYW1vREJEb2N1bWVudENsaWVudC5mcm9tKGRkYkNsaWVudCk7XG5cbmNvbnN0IERCX1RBQkxFX05BTUUgPSBwcm9jZXNzLmVudi5EQl9UQUJMRV9OQU1FO1xuaWYgKCFEQl9UQUJMRV9OQU1FKSB0aHJvdyBuZXcgRXJyb3IoJ0RCX1RBQkxFX05BTUUgZW52IHZhciBpcyBtaXNzaW5nJyk7XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXN5bmMgKFxuICBldmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnRWMixcbik6IFByb21pc2U8QVBJR2F0ZXdheVByb3h5UmVzdWx0VjI+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwcm9qZWN0SWQgPSBldmVudC5wYXRoUGFyYW1ldGVycz8uaWQ7XG4gICAgaWYgKCFwcm9qZWN0SWQpIHtcbiAgICAgIHJldHVybiBhcGlSZXNwb25zZSg0MDAsIHsgbWVzc2FnZTogJ01pc3NpbmcgcHJvamVjdElkJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBmbGF0UXVlc3Rpb25zID0gYXdhaXQgbG9hZFF1ZXN0aW9ucyhwcm9qZWN0SWQpO1xuICAgIGNvbnN0IGdyb3VwZWQgPSBhd2FpdCBncm91cFF1ZXN0aW9ucyhwcm9qZWN0SWQsIGZsYXRRdWVzdGlvbnMpO1xuXG4gICAgcmV0dXJuIGFwaVJlc3BvbnNlKDIwMCwgeyBzZWN0aW9uczogZ3JvdXBlZCB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcignZ2V0UHJvamVjdFF1ZXN0aW9ucyBlcnJvcicsIGVycik7XG4gICAgcmV0dXJuIGFwaVJlc3BvbnNlKDUwMCwge1xuICAgICAgbWVzc2FnZTogJ0ludGVybmFsIGVycm9yJyxcbiAgICAgIGVycm9yOiBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ1Vua25vd24nLFxuICAgIH0pO1xuICB9XG59O1xuXG4vLyAtLS0tLS0tLS0tIExPQUQgUVVFU1RJT05TIEZST00gRFlOQU1PREIgLS0tLS0tLS0tLVxuYXN5bmMgZnVuY3Rpb24gbG9hZFF1ZXN0aW9ucyhwcm9qZWN0SWQ6IHN0cmluZykge1xuICBsZXQgaXRlbXM6IGFueVtdID0gW107XG4gIGxldCBMYXN0S2V5OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0IHByZWZpeCA9IGAke3Byb2plY3RJZH0jYDtcblxuICBkbyB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZG9jQ2xpZW50LnNlbmQoXG4gICAgICBuZXcgUXVlcnlDb21tYW5kKHtcbiAgICAgICAgVGFibGVOYW1lOiBEQl9UQUJMRV9OQU1FLFxuICAgICAgICBLZXlDb25kaXRpb25FeHByZXNzaW9uOiAnI3BrID0gOnBrIEFORCBiZWdpbnNfd2l0aCgjc2ssIDpwcmVmaXgpJyxcbiAgICAgICAgRXhwcmVzc2lvbkF0dHJpYnV0ZU5hbWVzOiB7XG4gICAgICAgICAgJyNwayc6IFBLX05BTUUsXG4gICAgICAgICAgJyNzayc6IFNLX05BTUUsXG4gICAgICAgIH0sXG4gICAgICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IHtcbiAgICAgICAgICAnOnBrJzogUVVFU1RJT05fUEssXG4gICAgICAgICAgJzpwcmVmaXgnOiBwcmVmaXgsXG4gICAgICAgIH0sXG4gICAgICAgIEV4Y2x1c2l2ZVN0YXJ0S2V5OiBMYXN0S2V5LFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIGlmIChyZXMuSXRlbXMpIGl0ZW1zLnB1c2goLi4ucmVzLkl0ZW1zKTtcbiAgICBMYXN0S2V5ID0gcmVzLkxhc3RFdmFsdWF0ZWRLZXkgYXMgUmVjb3JkPHN0cmluZywgYW55PiB8IHVuZGVmaW5lZDtcbiAgfSB3aGlsZSAoTGFzdEtleSk7XG5cbiAgcmV0dXJuIGl0ZW1zO1xufVxuXG4vLyAtLS0tLS0tLS0tIEdFVCBTSU5HTEUgQU5TV0VSIEZPUiBRVUVTVElPTiAtLS0tLS0tLS0tXG4vLyBBTlNXRVIgUEsgPSBBTlNXRVJfUEtcbi8vIFNLID0gYCR7cHJvamVjdElkfSMke3F1ZXN0aW9uSWR9IyR7YW5zd2VySWR9YFxuLy8gYW5kIHRoZXJlIGlzIGF0IG1vc3Qgb25lIGl0ZW0gcGVyIHF1ZXN0aW9uIOKGkiB1c2UgTGltaXQ6IDFcbmFzeW5jIGZ1bmN0aW9uIGdldEFuc3dlcihwcm9qZWN0SWQ6IHN0cmluZywgcXVlc3Rpb25JZDogc3RyaW5nKSB7XG4gIGNvbnN0IHByZWZpeCA9IGAke3Byb2plY3RJZH0jJHtxdWVzdGlvbklkfSNgO1xuXG4gIGNvbnN0IHJlcyA9IGF3YWl0IGRvY0NsaWVudC5zZW5kKFxuICAgIG5ldyBRdWVyeUNvbW1hbmQoe1xuICAgICAgVGFibGVOYW1lOiBEQl9UQUJMRV9OQU1FLFxuICAgICAgS2V5Q29uZGl0aW9uRXhwcmVzc2lvbjogJyNwayA9IDpwayBBTkQgYmVnaW5zX3dpdGgoI3NrLCA6cHJlZml4KScsXG4gICAgICBFeHByZXNzaW9uQXR0cmlidXRlTmFtZXM6IHtcbiAgICAgICAgJyNwayc6IFBLX05BTUUsXG4gICAgICAgICcjc2snOiBTS19OQU1FLFxuICAgICAgfSxcbiAgICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IHtcbiAgICAgICAgJzpwayc6IEFOU1dFUl9QSyxcbiAgICAgICAgJzpwcmVmaXgnOiBwcmVmaXgsXG4gICAgICB9LFxuICAgICAgTGltaXQ6IDEsXG4gICAgfSksXG4gICk7XG5cbiAgaWYgKCFyZXMuSXRlbXMgfHwgcmVzLkl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHJlcy5JdGVtc1swXTtcbn1cblxuLy8gLS0tLS0tLS0tLSBHUk9VUCBJTlRPIEZFIFNIQVBFIC0tLS0tLS0tLS1cbmFzeW5jIGZ1bmN0aW9uIGdyb3VwUXVlc3Rpb25zKFxuICBwcm9qZWN0SWQ6IHN0cmluZyxcbiAgZmxhdDogYW55W10sXG4pIHtcbiAgY29uc3Qgc2VjdGlvbnNNYXAgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gIGZvciAoY29uc3QgaXRlbSBvZiBmbGF0KSB7XG4gICAgY29uc3Qgc2VjSWQgPSBpdGVtLnNlY3Rpb25JZDtcbiAgICBpZiAoIXNlY3Rpb25zTWFwLmhhcyhzZWNJZCkpIHtcbiAgICAgIHNlY3Rpb25zTWFwLnNldChzZWNJZCwge1xuICAgICAgICBpZDogc2VjSWQsXG4gICAgICAgIHRpdGxlOiBpdGVtLnNlY3Rpb25UaXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGl0ZW0uc2VjdGlvbkRlc2NyaXB0aW9uID8/IG51bGwsXG4gICAgICAgIHF1ZXN0aW9uczogW10sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBxSWQgPSBpdGVtLnF1ZXN0aW9uSWQgYXMgc3RyaW5nO1xuICAgIGNvbnN0IGFuc3dlckl0ZW0gPSBhd2FpdCBnZXRBbnN3ZXIocHJvamVjdElkLCBxSWQpO1xuXG4gICAgc2VjdGlvbnNNYXAuZ2V0KHNlY0lkKS5xdWVzdGlvbnMucHVzaCh7XG4gICAgICBpZDogcUlkLFxuICAgICAgcXVlc3Rpb246IGl0ZW0ucXVlc3Rpb25UZXh0LFxuICAgICAgYW5zd2VyOiBhbnN3ZXJJdGVtPy50ZXh0ID8/IG51bGwsXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gQXJyYXkuZnJvbShzZWN0aW9uc01hcC52YWx1ZXMoKSk7XG59XG4iXX0=